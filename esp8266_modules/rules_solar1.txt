On rules#timer=2 do
  gpio,2,1
  publish %sysname%/status,"%sysname%/%ip% Entering deep sleep"
if [switch#pmode]=0
     gpio,2,1 
     deepsleep,3600
else 
     gpio,2,0
 endif
endon  

On MQTT#disconnected do
    reboot
endon

on system#wake do
  timerset,1,1
  timerset,2,10
endon

On startSleep do
  timerset,1,1
  publish %sysname%/status,'%sysname%/%ip% EVENT startSleepMode RECEIVED'
  gpio,2,1
  delay,1000
  //pulse,2,0,200
  timerset,2,1
endon

On switch#pmode do
  // if switch programming mode=OFF goto BED
  if [switch#pmode]=0
    timerset,2,1
  endif
endon

On rules#timer=1 do
    publish %sysname%/status,"%sysname%/%ip% in no sleep mode"
    Publish %sysname%/time/value,%systime%
    publish %sysname%/bmp085/press,[bm085#press]
    publish %sysname%/bm085/temp,[bm085#temp]
    publish %sysname%/a0/a0,[a0#a0]
    if [switch#pmode]=1 // in programming mode continue sending data 
      timerset,1,30
    endif
endon

