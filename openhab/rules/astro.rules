val Procedures$Procedure0 updateAstroData = [ 
  val String fmtString = "%1$tH:%1$tM"
   logInfo("","PUBLISHING ASTRO Values, e.g. Azimuth = {}", Azimuth)
//   logInfo("","astro values elevation = {}", Elevation)
//   logInfo("","astro values MoonDistance = {}", MoonDistance)
//   logInfo("","astro values MoonPhase = {}", MoonPhase)
  val mqttActions = getActions("mqtt","mqtt:broker:myUnsecureBroker")
  val moonphase_val = MoonPhase.state.toString
  val sunrise_val = (Sunrise_Time.state as DateTimeType).format(fmtString)
  val sunset_val = (Sunset_Time.state as DateTimeType).format(fmtString)
  val moonrise_val = (MoonRise.state as DateTimeType).format(fmtString)
  val moonset_val = (MoonSet.state as DateTimeType).format(fmtString)

   mqttActions.publishMQTT("moonphase",moonphase_val,false)
   mqttActions.publishMQTT("sunrise",sunrise_val,false)
   mqttActions.publishMQTT("sunset",sunset_val,false)
   mqttActions.publishMQTT("azimut",Azimuth.state.toString,false)
   mqttActions.publishMQTT("elevation",Elevation.state.toString,false)
   mqttActions.publishMQTT("distance",MoonDistance.state.toString,false)
   mqttActions.publishMQTT("moonrise",moonrise_val,false)
   mqttActions.publishMQTT("moonset",moonset_val,false)

]

rule "astro update" // (used for checking astro values)" 
when
// Time cron "0 0/5 * * * ?" // time spec for future test
    Time cron "0 0 * * * ?" // time spec for release edition = 1 HOUR 
then
  updateAstroData.apply()  
end


rule "Use Update Level for Astro Data Update"
when 
  Item UpdateLevelSwitch received command
then 
    updateAstroData.apply()
end


